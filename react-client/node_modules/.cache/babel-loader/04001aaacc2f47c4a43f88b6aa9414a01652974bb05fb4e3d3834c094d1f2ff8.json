{"ast":null,"code":"// import React, { useState, useEffect } from 'react';\n// import { io } from 'socket.io-client';\n// import axios from 'axios';\n// import { v4 as uuidv4 } from 'uuid'; // âœ… UUID ì¶”ê°€\n// import './MessagePage.css';\n\n// const socket = io('http://localhost:5000');\n\n// const MessagePage = () => {\n//   const [member, setMember] = useState(null);\n//   const [messages, setMessages] = useState([]);\n//   const [inputText, setInputText] = useState('');\n//   const [recipient, setRecipient] = useState(null);\n//   const [members, setMembers] = useState([]);\n\n//   // âœ… ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ ë° ì „ì²´ ë©¤ë²„ ì¡°íšŒ\n//   useEffect(() => {\n//     async function fetchMemberData() {\n//       try {\n//         const token = localStorage.getItem(\"token\");\n//         const resMe = await axios.get('http://localhost:8090/api/users/me', {\n//           headers: { Authorization: `Bearer ${token}` }\n//         });\n//         setMember(resMe.data);\n\n//         const resMembers = await axios.get('http://localhost:8090/api/chat-members', {\n//           headers: { Authorization: `Bearer ${token}` }\n//         });\n\n//         const otherMembers = resMembers.data.filter(m => m.studentId !== resMe.data.studentId);\n//         setMembers(otherMembers);\n//       } catch (error) {\n//         console.error(\"ğŸš¨ ë©¤ë²„ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\", error);\n//       }\n//     }\n//     fetchMemberData();\n//   }, []);\n\n//   // âœ… ë°±ì—”ë“œì—ì„œ ì±„íŒ… ë‚´ì—­ ê°€ì ¸ì˜¤ê¸°\n//   useEffect(() => {\n//     async function fetchMessages() {\n//       if (!member || !recipient) return;\n\n//       try {\n//         const token = localStorage.getItem(\"token\");\n//         if (!token) {\n//           console.error(\"ğŸš¨ JWT í† í° ì—†ìŒ. ë¡œê·¸ì¸ í•„ìš”\");\n//           return;\n//         }\n\n//         const response = await axios.get(`http://localhost:8090/api/chat/messages/${member.studentId}`, {\n//           headers: { Authorization: `Bearer ${token}` }\n//         });\n\n//         console.log(\"âœ… ì±„íŒ… ë‚´ì—­:\", response.data);\n//         setMessages(response.data);\n//       } catch (error) {\n//         console.error(\"ğŸš¨ ì±„íŒ… ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\", error);\n//       }\n//     }\n\n//     fetchMessages();\n//   }, [member, recipient]);\n\n//   // âœ… ì‹¤ì‹œê°„ ë©”ì‹œì§€ ìˆ˜ì‹  (ì´ì „ ë¦¬ìŠ¤ë„ˆ ì •ë¦¬)\n//   useEffect(() => {\n//     const handleMessageReceive = (msg) => {\n//       console.log(\"ğŸ“© ìˆ˜ì‹ ëœ ë©”ì‹œì§€:\", msg);\n\n//       setMessages(prev => {\n//         if (prev.some(m => m.id === msg.id)) { // âœ… ì¤‘ë³µ ë©”ì‹œì§€ í•„í„°ë§\n//           console.warn(\"âš ï¸ ì¤‘ë³µ ë©”ì‹œì§€ ê°ì§€ - ì¶”ê°€ ì•ˆ í•¨\", msg);\n//           return prev;\n//         }\n//         return [...prev, msg];\n//       });\n//     };\n\n//     socket.off('chat message');  // âœ… ê¸°ì¡´ ì´ë²¤íŠ¸ ì œê±°\n//     socket.on('chat message', handleMessageReceive);  // âœ… ìƒˆë¡œìš´ ë¦¬ìŠ¤ë„ˆ ë“±ë¡\n\n//     return () => {\n//       socket.off('chat message', handleMessageReceive);  // âœ… ì–¸ë§ˆìš´íŠ¸ ì‹œ ì •ë¦¬\n//     };\n//   }, [member, recipient]);\n\n//   // âœ… ë©”ì‹œì§€ ì „ì†¡ ì²˜ë¦¬\n//   const handleSend = async () => {\n//     const trimmedText = inputText.trim();\n//     if (!trimmedText || !recipient || !member) return;\n\n//     const newMsg = {\n//       sender: member.studentId,\n//       recipient: recipient.studentId,\n//       content: trimmedText\n//     };\n\n//     try {\n//       const response = await axios.post(\"http://localhost:8090/api/chat/send\", newMsg, {\n//         headers: { Authorization: `Bearer ${localStorage.getItem(\"token\")}` }\n//       });\n\n//       console.log(\"âœ… ì „ì†¡ëœ ë©”ì‹œì§€:\", response.data);\n\n//       // âœ… UUID í™œìš©í•˜ì—¬ key ì¤‘ë³µ ë¬¸ì œ í•´ê²°\n//       setMessages((prev) => [\n//         ...prev,\n//         { ...response.data, id: response.data.id || uuidv4() }\n//       ]);\n\n//       socket.emit('chat message', response.data);\n//       setInputText('');\n//     } catch (error) {\n//       console.error(\"ğŸš¨ ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨\", error);\n//     }\n//   };\n\n//   return (\n//     <div className=\"message-page-container\">\n//       <div className=\"chat-area\">\n//         <div className=\"chat-header\">\n//           {member && recipient \n//             ? `${member.name}ê³¼ ${recipient.name}ì˜ ëŒ€í™”`\n//             : \"ìˆ˜ì‹ ìë¥¼ ì„ íƒí•˜ì„¸ìš”\"}\n//         </div>\n\n//         <div className=\"recipient-selector\">\n//           <label>ë°›ëŠ” ì‚¬ëŒ: </label>\n//           <select onChange={(e) => setRecipient(members.find(m => m.studentId === e.target.value))}>\n//             <option value=\"\" disabled>ğŸ“© ë°›ëŠ” ì‚¬ëŒì„ ì„ íƒí•˜ì„¸ìš”</option>\n//             {members.map(m => (\n//               <option key={m.studentId} value={m.studentId}>\n//                 {m.name}\n//               </option>\n//             ))}\n//           </select>\n//         </div>\n\n//         <div className=\"chat-messages\">\n//           {messages.map((msg) => (\n//             <div key={msg.id || uuidv4()} // âœ… UUID í™œìš©í•˜ì—¬ ì¤‘ë³µ í‚¤ ë°©ì§€\n//                  className={`chat-message ${msg.sender === member?.studentId ? 'sent' : 'received'}`}>\n//               <span>{msg.sender}: </span>\n//               <span>{msg.content}</span>\n//             </div>\n//           ))}\n//         </div>\n\n//         <div className=\"chat-input\">\n//           <input \n//             type=\"text\" \n//             value={inputText} \n//             onChange={(e) => setInputText(e.target.value)} \n//             placeholder=\"ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”...\" \n//           />\n//           <button onClick={handleSend}>ì „ì†¡</button>\n//         </div>\n//       </div>\n//     </div>\n//   );\n// };\n\n// export default MessagePage;","map":{"version":3,"names":[],"sources":["C:/Users/BIG60309/react-client/src/components/Message/MessagePage.jsx"],"sourcesContent":["// import React, { useState, useEffect } from 'react';\r\n// import { io } from 'socket.io-client';\r\n// import axios from 'axios';\r\n// import { v4 as uuidv4 } from 'uuid'; // âœ… UUID ì¶”ê°€\r\n// import './MessagePage.css';\r\n\r\n// const socket = io('http://localhost:5000');\r\n\r\n// const MessagePage = () => {\r\n//   const [member, setMember] = useState(null);\r\n//   const [messages, setMessages] = useState([]);\r\n//   const [inputText, setInputText] = useState('');\r\n//   const [recipient, setRecipient] = useState(null);\r\n//   const [members, setMembers] = useState([]);\r\n\r\n//   // âœ… ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ ë° ì „ì²´ ë©¤ë²„ ì¡°íšŒ\r\n//   useEffect(() => {\r\n//     async function fetchMemberData() {\r\n//       try {\r\n//         const token = localStorage.getItem(\"token\");\r\n//         const resMe = await axios.get('http://localhost:8090/api/users/me', {\r\n//           headers: { Authorization: `Bearer ${token}` }\r\n//         });\r\n//         setMember(resMe.data);\r\n\r\n//         const resMembers = await axios.get('http://localhost:8090/api/chat-members', {\r\n//           headers: { Authorization: `Bearer ${token}` }\r\n//         });\r\n\r\n//         const otherMembers = resMembers.data.filter(m => m.studentId !== resMe.data.studentId);\r\n//         setMembers(otherMembers);\r\n//       } catch (error) {\r\n//         console.error(\"ğŸš¨ ë©¤ë²„ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\", error);\r\n//       }\r\n//     }\r\n//     fetchMemberData();\r\n//   }, []);\r\n\r\n//   // âœ… ë°±ì—”ë“œì—ì„œ ì±„íŒ… ë‚´ì—­ ê°€ì ¸ì˜¤ê¸°\r\n//   useEffect(() => {\r\n//     async function fetchMessages() {\r\n//       if (!member || !recipient) return;\r\n\r\n//       try {\r\n//         const token = localStorage.getItem(\"token\");\r\n//         if (!token) {\r\n//           console.error(\"ğŸš¨ JWT í† í° ì—†ìŒ. ë¡œê·¸ì¸ í•„ìš”\");\r\n//           return;\r\n//         }\r\n\r\n//         const response = await axios.get(`http://localhost:8090/api/chat/messages/${member.studentId}`, {\r\n//           headers: { Authorization: `Bearer ${token}` }\r\n//         });\r\n\r\n//         console.log(\"âœ… ì±„íŒ… ë‚´ì—­:\", response.data);\r\n//         setMessages(response.data);\r\n//       } catch (error) {\r\n//         console.error(\"ğŸš¨ ì±„íŒ… ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\", error);\r\n//       }\r\n//     }\r\n\r\n//     fetchMessages();\r\n//   }, [member, recipient]);\r\n\r\n//   // âœ… ì‹¤ì‹œê°„ ë©”ì‹œì§€ ìˆ˜ì‹  (ì´ì „ ë¦¬ìŠ¤ë„ˆ ì •ë¦¬)\r\n//   useEffect(() => {\r\n//     const handleMessageReceive = (msg) => {\r\n//       console.log(\"ğŸ“© ìˆ˜ì‹ ëœ ë©”ì‹œì§€:\", msg);\r\n  \r\n//       setMessages(prev => {\r\n//         if (prev.some(m => m.id === msg.id)) { // âœ… ì¤‘ë³µ ë©”ì‹œì§€ í•„í„°ë§\r\n//           console.warn(\"âš ï¸ ì¤‘ë³µ ë©”ì‹œì§€ ê°ì§€ - ì¶”ê°€ ì•ˆ í•¨\", msg);\r\n//           return prev;\r\n//         }\r\n//         return [...prev, msg];\r\n//       });\r\n//     };\r\n  \r\n//     socket.off('chat message');  // âœ… ê¸°ì¡´ ì´ë²¤íŠ¸ ì œê±°\r\n//     socket.on('chat message', handleMessageReceive);  // âœ… ìƒˆë¡œìš´ ë¦¬ìŠ¤ë„ˆ ë“±ë¡\r\n  \r\n//     return () => {\r\n//       socket.off('chat message', handleMessageReceive);  // âœ… ì–¸ë§ˆìš´íŠ¸ ì‹œ ì •ë¦¬\r\n//     };\r\n//   }, [member, recipient]);\r\n  \r\n\r\n//   // âœ… ë©”ì‹œì§€ ì „ì†¡ ì²˜ë¦¬\r\n//   const handleSend = async () => {\r\n//     const trimmedText = inputText.trim();\r\n//     if (!trimmedText || !recipient || !member) return;\r\n\r\n//     const newMsg = {\r\n//       sender: member.studentId,\r\n//       recipient: recipient.studentId,\r\n//       content: trimmedText\r\n//     };\r\n\r\n//     try {\r\n//       const response = await axios.post(\"http://localhost:8090/api/chat/send\", newMsg, {\r\n//         headers: { Authorization: `Bearer ${localStorage.getItem(\"token\")}` }\r\n//       });\r\n\r\n//       console.log(\"âœ… ì „ì†¡ëœ ë©”ì‹œì§€:\", response.data);\r\n\r\n//       // âœ… UUID í™œìš©í•˜ì—¬ key ì¤‘ë³µ ë¬¸ì œ í•´ê²°\r\n//       setMessages((prev) => [\r\n//         ...prev,\r\n//         { ...response.data, id: response.data.id || uuidv4() }\r\n//       ]);\r\n\r\n//       socket.emit('chat message', response.data);\r\n//       setInputText('');\r\n//     } catch (error) {\r\n//       console.error(\"ğŸš¨ ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨\", error);\r\n//     }\r\n//   };\r\n\r\n//   return (\r\n//     <div className=\"message-page-container\">\r\n//       <div className=\"chat-area\">\r\n//         <div className=\"chat-header\">\r\n//           {member && recipient \r\n//             ? `${member.name}ê³¼ ${recipient.name}ì˜ ëŒ€í™”`\r\n//             : \"ìˆ˜ì‹ ìë¥¼ ì„ íƒí•˜ì„¸ìš”\"}\r\n//         </div>\r\n\r\n//         <div className=\"recipient-selector\">\r\n//           <label>ë°›ëŠ” ì‚¬ëŒ: </label>\r\n//           <select onChange={(e) => setRecipient(members.find(m => m.studentId === e.target.value))}>\r\n//             <option value=\"\" disabled>ğŸ“© ë°›ëŠ” ì‚¬ëŒì„ ì„ íƒí•˜ì„¸ìš”</option>\r\n//             {members.map(m => (\r\n//               <option key={m.studentId} value={m.studentId}>\r\n//                 {m.name}\r\n//               </option>\r\n//             ))}\r\n//           </select>\r\n//         </div>\r\n\r\n//         <div className=\"chat-messages\">\r\n//           {messages.map((msg) => (\r\n//             <div key={msg.id || uuidv4()} // âœ… UUID í™œìš©í•˜ì—¬ ì¤‘ë³µ í‚¤ ë°©ì§€\r\n//                  className={`chat-message ${msg.sender === member?.studentId ? 'sent' : 'received'}`}>\r\n//               <span>{msg.sender}: </span>\r\n//               <span>{msg.content}</span>\r\n//             </div>\r\n//           ))}\r\n//         </div>\r\n\r\n//         <div className=\"chat-input\">\r\n//           <input \r\n//             type=\"text\" \r\n//             value={inputText} \r\n//             onChange={(e) => setInputText(e.target.value)} \r\n//             placeholder=\"ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”...\" \r\n//           />\r\n//           <button onClick={handleSend}>ì „ì†¡</button>\r\n//         </div>\r\n//       </div>\r\n//     </div>\r\n//   );\r\n// };\r\n\r\n// export default MessagePage;\r\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}